<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Singapore Card Benefits Finder</title>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 20px;
  background: #f5f7fa;
  color: #333;
}
h1 { text-align: center; color: #2c3e50; }
.container { max-width: 1000px; margin: auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
input, select, button { padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; }
button { cursor: pointer; background-color: #2980b9; color: white; border: none; }
button:hover { background-color: #3498db; }
label { display: block; margin-top: 10px; font-weight: bold; }
#results-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
#results-table th, #results-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
#results-table th { background-color: #2980b9; color: white; }
.owned { background-color: #dff0d8; }
.autocomplete-suggestions { border: 1px solid #ccc; max-height: 150px; overflow-y: auto; position: absolute; background: white; z-index: 1000; }
.autocomplete-suggestion { padding: 5px; cursor: pointer; }
.autocomplete-suggestion:hover { background: #3498db; color: white; }
</style>
</head>
<body>
<div class="container">
<h1>Singapore Credit Card Benefits Finder</h1>

<label for="merchant-input">Merchant (type or use voice ðŸŽ¤)</label>
<input type="text" id="merchant-input" placeholder="Enter merchant name">
<button id="voice-btn">ðŸŽ¤ Speak</button>

<label for="user-cards">Select your cards (Ctrl/Cmd + Click for multiple):</label>
<select id="user-cards" multiple size="5"></select>

<button id="search-btn">Find Best Cards</button>

<table id="results-table">
  <thead>
    <tr>
      <th>Rank</th>
      <th>Card</th>
      <th>Benefit Types</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
</div>

<script>
// =================== Cards Data ===================
const cardsData = {
  "DBS": [
    {
      "card_name": "DBS Live Fresh Credit Card",
      "type": "credit",
      "category": "cashback",
      "benefits": {
        "online_shopping": {
          "description": "5% cashback on online and contactless spend.",
          "merchants": [
            {"name": "Shopee", "aliases": ["Shopee SG"], "mcc": [5311]},
            {"name": "Lazada", "aliases": ["Lazada SG"], "mcc": [5311]},
            {"name": "Amazon Singapore", "aliases": ["Amazon SG"], "mcc": [5311]},
            {"name": "Qoo10", "aliases": [], "mcc": [5311]}
          ]
        },
        "supermarkets": {
          "description": "5% cashback at participating supermarkets.",
          "merchants": [
            {"name": "NTUC FairPrice", "aliases": ["FairPrice", "NTUC"], "mcc": [5411]},
            {"name": "Cold Storage", "aliases": ["Cold Storage SG"], "mcc": [5411]},
            {"name": "Giant", "aliases": ["Giant Singapore"], "mcc": [5411]},
            {"name": "Sheng Siong", "aliases": [], "mcc": [5411]}
          ]
        },
        "dining": {
          "description": "5% cashback at cafes, fast food, restaurants.",
          "merchants": [
            {"name": "Starbucks", "aliases": ["Starbucks SG"], "mcc": [5814]},
            {"name": "McDonald's", "aliases": ["Macdonalds", "McDonalds SG"], "mcc": [5814]},
            {"name": "KFC", "aliases": ["Kentucky Fried Chicken"], "mcc": [5814]},
            {"name": "Subway", "aliases": [], "mcc": [5814]},
            {"name": "Toast Box", "aliases": [], "mcc": [5814]}
          ]
        }
      }
    }
  ],
  // Add all other banks/cards similarly (POSB, UOB, OCBC, Citi, HSBC, Maybank, Standard Chartered, Trust, DCS)
};

// =================== Merchant List ===================
let merchantList = [];
for (const bank in cardsData) {
  cardsData[bank].forEach(card => {
    for (const benefit in card.benefits) {
      card.benefits[benefit].merchants.forEach(m => {
        merchantList.push(m.name);
        m.aliases.forEach(a => merchantList.push(a));
      });
    }
  });
}
merchantList = [...new Set(merchantList)]; // unique

// =================== Populate User Cards Dropdown ===================
const userCardsSelect = document.getElementById('user-cards');
for (const bank in cardsData) {
  cardsData[bank].forEach(card => {
    const option = document.createElement('option');
    option.value = `${bank}||${card.card_name}`;
    option.text = `${bank} - ${card.card_name}`;
    userCardsSelect.appendChild(option);
  });
}

// =================== Autocomplete ===================
const merchantInput = document.getElementById('merchant-input');
let suggestionsBox;

merchantInput.addEventListener('input', function() {
  const val = this.value.toLowerCase();
  closeSuggestions();
  if (!val) return;
  suggestionsBox = document.createElement('div');
  suggestionsBox.classList.add('autocomplete-suggestions');
  this.parentNode.appendChild(suggestionsBox);
  merchantList.forEach(merchant => {
    if (merchant.toLowerCase().includes(val)) {
      const div = document.createElement('div');
      div.classList.add('autocomplete-suggestion');
      div.innerText = merchant;
      div.addEventListener('click', () => {
        merchantInput.value = merchant;
        closeSuggestions();
      });
      suggestionsBox.appendChild(div);
    }
  });
});

function closeSuggestions() { if (suggestionsBox) suggestionsBox.remove(); }

// =================== Voice Input ===================
const voiceBtn = document.getElementById('voice-btn');
voiceBtn.addEventListener('click', () => {
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'en-US';
  recognition.start();
  recognition.onresult = function(event) {
    merchantInput.value = event.results[0][0].transcript;
    recognition.stop();
  };
});

// =================== Find Best Cards ===================
document.getElementById('search-btn').addEventListener('click', findBestCards);

function findBestCards() {
  const merchant = merchantInput.value.trim().toLowerCase();
  const selectedCards = Array.from(userCardsSelect.selectedOptions).map(o => o.value);
  const results = [];

  for (const bank in cardsData) {
    cardsData[bank].forEach(card => {
      let totalScore = 0;
      let benefitDetails = [];

      for (const benefit in card.benefits) {
        card.benefits[benefit].merchants.forEach(m => {
          if (m.name.toLowerCase() === merchant || m.aliases.some(a => a.toLowerCase() === merchant)) {
            const desc = card.benefits[benefit].description;
            let score = 0;
            const match = desc.match(/(\d+\.?\d*)/);
            if (match) score = parseFloat(match[1]);
            totalScore += score;
            benefitDetails.push({type: benefit, description: desc, score});
          }
        });
      }

      if (benefitDetails.length > 0) {
        results.push({
          bank, card: card.card_name, totalScore, benefitDetails, owned: selectedCards.includes(`${bank}||${card.card_name}`)
        });
      }
    });
  }

  results.sort((a,b) => b.totalScore - a.totalScore);
  const tbody = document.querySelector('#results-table tbody');
  tbody.innerHTML = '';
  results.forEach((r,i) => {
    const tr = document.createElement('tr');
    if (r.owned) tr.classList.add('owned');
    const benefitsText = r.benefitDetails.map(d => `${d.type}: ${d.description}`).join('<br>');
    tr.innerHTML = `<td>${i+1}</td>
                    <td>${r.bank} - ${r.card}</td>
                    <td>${r.benefitDetails.map(d=>d.type).join(', ')}</td>
                    <td>${benefitsText}</td>`;
    tbody.appendChild(tr);
  });
}
</script>
</body>
</html>
