<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Best Credit Card Finder</title>
<style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 20px;
  background-color: #f8f9fa;
  color: #333;
}
h1 {
  text-align: center;
  color: #007bff;
  margin-bottom: 20px;
}
label {
  font-weight: bold;
}
input[type="text"] {
  width: 100%;
  max-width: 400px;
  padding: 8px 12px;
  margin: 5px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  font-size: 14px;
}
select {
  width: 100%;
  max-width: 400px;
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
  box-sizing: border-box;
}
button {
  padding: 8px 16px;
  border-radius: 6px;
  border: none;
  background-color: #007bff;
  color: #fff;
  cursor: pointer;
  margin-left: 5px;
  font-size: 14px;
}
button:hover {
  background-color: #0056b3;
}
.autocomplete-suggestions {
  border: 1px solid #ccc;
  max-height: 180px;
  overflow-y: auto;
  background: #fff;
  position: absolute;
  z-index: 1000;
  width: 100%;
  border-radius: 6px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}
.autocomplete-suggestion {
  padding: 8px 12px;
  cursor: pointer;
}
.autocomplete-suggestion:hover {
  background-color: #e9ecef;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin-top: 20px;
  background: #fff;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
th, td {
  border-bottom: 1px solid #dee2e6;
  padding: 12px 8px;
  text-align: left;
  font-size: 14px;
}
th {
  background-color: #007bff;
  color: #fff;
  position: sticky;
  top: 0;
}
tr:nth-child(even) {
  background-color: #f2f2f2;
}
tr.owned {
  background-color: #d4edda;
}
.benefits-list {
  margin: 0;
  padding-left: 18px;
  font-size: 13px;
}
@media screen and (max-width: 768px) {
  input[type="text"], select {
    width: 100%;
  }
  th, td {
    font-size: 12px;
  }
}
.mic-btn {
  background-color: #28a745;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  border: none;
  cursor: pointer;
  vertical-align: middle;
  margin-left: 5px;
}
.mic-btn:hover {
  background-color: #218838;
}
</style>
</head>
<body>

<h1>Singapore Best Credit Card Finder</h1>

<div>
  <label for="merchant-input">Enter Merchant:</label><br>
  <input type="text" id="merchant-input" placeholder="Start typing merchant name">
  <button class="mic-btn" id="voice-btn">ðŸŽ¤</button>
  <div id="autocomplete-container" class="autocomplete-suggestions"></div>
</div>

<div style="margin-top: 15px;">
  <label for="user-cards">Your Cards:</label><br>
  <select id="user-cards" multiple></select>
</div>

<div style="margin-top: 15px;">
  <button id="find-cards-btn">Find Best Cards</button>
</div>

<table id="results-table">
  <thead>
    <tr>
      <th>Rank</th>
      <th>Bank / Card</th>
      <th>Benefit Type</th>
      <th>Benefit Details</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// ===================== CARD DATA =====================
const cardsData = {
  "DBS": [
    {
      "card_name": "DBS Live Fresh Credit Card",
      "type": "credit",
      "category": "cashback",
      "benefits": {
        "online_shopping": {"description": "5% cashback on online and contactless spend.", "merchants": ["Shopee","Lazada","Amazon Singapore","Qoo10"]},
        "supermarkets": {"description": "5% cashback at participating supermarkets.", "merchants": ["NTUC FairPrice","Cold Storage","Giant","Sheng Siong"]},
        "dining": {"description": "5% cashback at cafes, fast food, restaurants.", "merchants": ["Starbucks","McDonald's","KFC","Subway","Toast Box"]}
      }
    },
    {
      "card_name": "DBS Womanâ€™s World Card",
      "type": "credit",
      "category": "miles",
      "benefits": {
        "online_shopping": {"description": "4 mpd for all online spend.", "merchants": ["Shopee","Lazada","Amazon Singapore","Qoo10","Zalora"]}
      }
    }
  ],
  "POSB": [
    {
      "card_name": "POSB Everyday Card",
      "type": "credit",
      "category": "cashback",
      "benefits": {
        "supermarkets": {"description": "Up to 5% cashback at Sheng Siong.", "merchants": ["Sheng Siong"]},
        "petrol": {"description": "Up to 20.1% savings at SPC.", "merchants": ["SPC"]}
      }
    }
  ]
};

// Flatten merchant list for autocomplete
let allMerchants = [];
for (const bank in cardsData) {
  cardsData[bank].forEach(card => {
    for (const benefit in card.benefits) {
      card.benefits[benefit].merchants.forEach(m => allMerchants.push(m));
    }
  });
}
allMerchants = [...new Set(allMerchants)]; // unique

// Populate user card selection
const userCardsSelect = document.getElementById('user-cards');
for (const bank in cardsData) {
  cardsData[bank].forEach(card => {
    const option = document.createElement('option');
    option.value = `${bank}||${card.card_name}`;
    option.text = `${bank} - ${card.card_name}`;
    userCardsSelect.appendChild(option);
  });
}

// ===================== AUTO-COMPLETE =====================
const merchantInput = document.getElementById('merchant-input');
const autocompleteContainer = document.getElementById('autocomplete-container');

merchantInput.addEventListener('input', function() {
  const val = this.value.toLowerCase();
  autocompleteContainer.innerHTML = '';
  if (!val) return;
  allMerchants.filter(m => m.toLowerCase().includes(val)).forEach(m => {
    const div = document.createElement('div');
    div.className = 'autocomplete-suggestion';
    div.textContent = m;
    div.addEventListener('click', () => {
      merchantInput.value = m;
      autocompleteContainer.innerHTML = '';
    });
    autocompleteContainer.appendChild(div);
  });
});

// ===================== VOICE INPUT =====================
const voiceBtn = document.getElementById('voice-btn');
if ('webkitSpeechRecognition' in window) {
  const recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';

  voiceBtn.addEventListener('click', () => {
    recognition.start();
  });

  recognition.onresult = function(event) {
    merchantInput.value = event.results[0][0].transcript;
    autocompleteContainer.innerHTML = '';
  };
}

// ===================== CARD RANKING =====================
function findBestCards() {
  const merchant = merchantInput.value.trim().toLowerCase();
  const selectedCards = Array.from(userCardsSelect.selectedOptions).map(o => o.value);

  const results = [];

  for (const bank in cardsData) {
    cardsData[bank].forEach(card => {
      let maxBenefit = 0;
      let benefitDetails = [];
      for (const benefit in card.benefits) {
        const merchants = card.benefits[benefit].merchants.map(m => m.toLowerCase());
        if (merchants.includes(merchant)) {
          // crude scoring: cashback% or mpd assumed numeric in description
          let score = 0;
          const match = card.benefits[benefit].description.match(/(\d+\.?\d*)/);
          if (match) score = parseFloat(match[1]);
          if (score > maxBenefit) {
            maxBenefit = score;
            benefitDetails = [{
              type: benefit,
              description: card.benefits[benefit].description
            }];
          } else if (score === maxBenefit) {
            benefitDetails.push({
              type: benefit,
              description: card.benefits[benefit].description
            });
          }
        }
      }
      if (maxBenefit > 0) {
        results.push({
          bank: bank,
          card: card.card_name,
          maxBenefit,
          benefitDetails,
          owned: selectedCards.includes(`${bank}||${card.card_name}`)
        });
      }
    });
  }

  results.sort((a,b) => b.maxBenefit - a.maxBenefit);

  // Populate table
  const tbody = document.querySelector('#results-table tbody');
  tbody.innerHTML = '';
  results.forEach((r,i) => {
    const tr = document.createElement('tr');
    if (r.owned) tr.classList.add('owned');
    const benefitsText = r.benefitDetails.map(d => `${d.type}: ${d.description}`).join('<br>');
    tr.innerHTML = `<td>${i+1}</td>
                    <td>${r.bank} - ${r.card}</td>
                    <td>${r.benefitDetails.map(d=>d.type).join(', ')}</td>
                    <td>${benefitsText}</td>`;
    tbody.appendChild(tr);
  });
}

// ===================== BUTTON EVENT =====================
document.getElementById('find-cards-btn').addEventListener('click', findBestCards);
</script>

</body>
</html>
